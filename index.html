<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TV Portfolio - Fixed Example</title>

  <!-- Load YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <!-- GSAP for animations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>

  <style>
    :root {
      --bg-color: #000;
      --primary-color: #fff;
      --header-bg: rgba(0, 0, 0, 0.85);
    }

    body {
      margin: 0;
      background: var(--bg-color);
      color: var(--primary-color);
      font-family: sans-serif;
      overflow: hidden; /* We'll remove this when we want the main content to scroll */
    }

    .video-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      /* CHANGED from -1 to 0 to ensure it's above the background color */
      z-index: 0; 
      overflow: hidden;
      opacity: 1; /* Weâ€™ll fade in/out as needed */
      transition: opacity 0.5s ease;
    }
    .video-background iframe {
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    /* Landing Screen */
    #landing {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg-color);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100;
    }
    .power-button {
      width: 100px;
      height: 100px;
      background: red;
      border-radius: 50%;
      cursor: pointer;
      margin-bottom: 10px;
    }

    /* Show main content only after landing is turned off */
    #mainContent {
      display: none;
    }

    /* Mute button */
    #muteButton {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 350;
      display: none;
      background: #333;
      color: #fff;
      padding: 8px 12px;
      border: none;
      cursor: pointer;
    }

    /* Example channel sections */
    .channel-section {
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px dashed #444;
      scroll-snap-align: start;
      position: relative;
    }
  </style>
</head>
<body>

  <!-- Video Background -->
  <div class="video-background" id="videoBackground">
    <div id="videoContainer">
      <iframe id="videoIframe"
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen></iframe>
    </div>
  </div>

  <!-- Landing Overlay -->
  <div id="landing">
    <div class="power-button" id="powerButton">POWER</div>
    <h1 id="landingName">Kayron Calloway</h1>
  </div>

  <!-- Mute Button -->
  <button id="muteButton">Mute</button>

  <!-- Main Content -->
  <div id="mainContent">
    <!-- Example sections for IntersectionObserver -->
    <section id="section1" class="channel-section" style="background: #111; color: #fff;">
      <h1>Channel 1</h1>
    </section>
    <section id="section2" class="channel-section" style="background: #222; color: #fff;">
      <h1>Channel 2</h1>
    </section>
    <section id="section3" class="channel-section" style="background: #333; color: #fff;">
      <h1>Channel 3</h1>
    </section>
  </div>

  <script>
    // --- 1) Global Variables ---
    // Set this to TRUE so Safari allows autoplay with muted audio
    let soundMuted = true;
    let videoPlayer;
    let currentChannel = null;
    let landingSequenceComplete = false;
    let autoScrollTimeout;

    // --- 2) YouTube IFrame API Setup ---
    function onYouTubeIframeAPIReady() {
      console.log("onYouTubeIframeAPIReady triggered. Origin:", window.location.origin);
      videoPlayer = new YT.Player('videoIframe', {
        videoId: 'KISNE4qOIBM',
        playerVars: {
          autoplay: 1,
          controls: 0,
          loop: 1,
          playlist: 'KISNE4qOIBM', 
          modestbranding: 1,
          showinfo: 0,
          rel: 0,
          // IMPORTANT: remove trailing slash if your GH pages domain is exactly:
          // https://kayroncalloway.github.io
          origin: "https://kayroncalloway.github.io",
          host: "https://www.youtube.com"
        },
        events: {
          'onReady': onPlayerReady,
          'onError': onPlayerError
        }
      });
    }

    function onPlayerReady(event) {
      // Mute if soundMuted == true
      if (soundMuted) {
        event.target.mute();
      } else {
        event.target.unMute();
      }
      // This can confirm autoplay: event.target.playVideo();
    }

    function onPlayerError(event) {
      console.error("Video Player Error:", event.data);
    }

    // --- 3) DOMContentLoaded Logic ---
    document.addEventListener('DOMContentLoaded', () => {
      const powerButton = document.getElementById('powerButton');
      const landing = document.getElementById('landing');
      const mainContent = document.getElementById('mainContent');
      const muteButton = document.getElementById('muteButton');
      const videoBackground = document.getElementById('videoBackground');

      // Turn On Sequence
      powerButton.addEventListener('click', () => {
        powerButton.style.pointerEvents = 'none';

        // Quick fade-out/hide the landing
        gsap.to(powerButton, {
          duration: 0.3,
          opacity: 0,
          onComplete: () => {
            powerButton.style.display = 'none';
          }
        });

        gsap.to(landing, {
          duration: 0.5,
          opacity: 0,
          onComplete: () => {
            landing.style.display = 'none';

            // Show the main content
            mainContent.style.display = 'block';
            document.body.style.overflow = 'auto'; // re-enable scroll

            // Show the mute button
            muteButton.style.display = 'block';
            gsap.to(muteButton, { duration: 0.5, opacity: 1 });

            // If you'd like, scroll user to section1:
            window.scrollTo({ top: 0, behavior: 'smooth' });

            landingSequenceComplete = true;
          }
        });
      });

      // Mute Toggle
      muteButton.addEventListener('click', () => {
        soundMuted = !soundMuted;
        muteButton.textContent = soundMuted ? "Unmute" : "Mute";
        if (videoPlayer) {
          if (soundMuted) videoPlayer.mute();
          else videoPlayer.unMute();
        }
      });

      // IntersectionObserver to fade in/out the video background
      const observerOptions = { root: null, threshold: 0.1 }; // lower threshold
      const observerCallback = entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const newChannel = entry.target.id;
            if (currentChannel !== newChannel) {
              currentChannel = newChannel;
              console.log("Now viewing:", currentChannel);

              // If Channel 1 is visible, fade the background up
              if (currentChannel === "section1") {
                gsap.to(videoBackground, { duration: 0.5, opacity: 1 });
              } else {
                gsap.to(videoBackground, { duration: 0.5, opacity: 0 });
              }
            }
          }
        });
      };
      const observer = new IntersectionObserver(observerCallback, observerOptions);
      document.querySelectorAll('.channel-section').forEach(section => observer.observe(section));
    });
  </script>
</body>
</html>
